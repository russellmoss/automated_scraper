<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Savvy Pirate</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <img src="../icons/icon48.png" alt="Savvy Pirate" class="logo">
        <div class="header-text">
            <h1>Savvy Pirate</h1>
            <span class="version">v2.0</span>
        </div>
        <div id="status-indicator" class="status-indicator"></div>
    </header>
    
    <main class="main-content">
        <!-- SECTION: Workbook Configuration (Live Sync) -->
        <section class="section" id="section-workbook-config">
            <div class="section-header" data-section="workbook-config">
                <span>üìò Workbook Configuration (Live Sync)</span>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="input-group">
                    <input type="text" id="workbook-url" name="workbook-url" placeholder="Master workbook URL or ID">
                    <button id="load-workbook-btn" class="btn btn-primary">Load</button>
                </div>

                <div class="input-group">
                    <button id="sync-workbook-btn" class="btn btn-secondary">Sync Now</button>
                    <button id="clear-workbook-btn" class="btn btn-outline">Clear</button>
                </div>

                <div class="input-group">
                    <label for="sync-interval-select">Sync interval</label>
                    <select id="sync-interval-select" name="sync-interval-select">
                        <option value="1">1 min</option>
                        <option value="5" selected>5 min</option>
                        <option value="10">10 min</option>
                        <option value="15">15 min</option>
                        <option value="30">30 min</option>
                        <option value="60">60 min</option>
                    </select>
                </div>

                <div id="sync-status-container" class="info-box hidden"></div>
                <div id="sync-changes-container" class="results-box hidden"></div>
            </div>
        </section>
        
        <!-- SECTION: Workbook Mappings -->
        <section class="section" id="section-mappings">
            <div class="section-header" data-section="mappings">
                <span>üìÅ Workbook Mappings</span>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="section-content">
                <div id="mapping-list" class="mapping-list"></div>
                <button id="add-workbook-btn" class="btn btn-secondary">+ Add Workbook</button>
            </div>
        </section>
        
        <!-- SECTION: Manual Scraping -->
        <section class="section" id="section-scraping">
            <div class="section-header" data-section="scraping">
                <span>üîç Manual Scraping</span>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="input-group">
                    <select id="source-select" name="source-select">
                        <option value="">Select source...</option>
                    </select>
                </div>
                <div class="button-group">
                    <button id="start-scrape-btn" class="btn btn-primary">‚ñ∂ Start Scrape</button>
                    <button id="stop-scrape-btn" class="btn btn-danger hidden">‚èπ Stop</button>
                </div>
                <div id="scrape-progress" class="progress-container hidden">
                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>
                    <span id="progress-text"></span>
                </div>
            </div>
        </section>
        
        <!-- SECTION: Compare Tabs -->
        <section class="section" id="section-compare">
            <div class="section-header" data-section="compare">
                <span>üìä Compare Tabs</span>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="input-group">
                    <select id="compare-workbook-select" name="compare-workbook-select">
                        <option value="">Select workbook...</option>
                    </select>
                </div>
                <div class="compare-grid">
                    <div class="compare-column">
                        <label for="compare-tab1">Baseline Tab (older)</label>
                        <select id="compare-tab1" name="compare-tab1"></select>
                    </div>
                    <div class="compare-column">
                        <label for="compare-tab2">Compare Tab (newer)</label>
                        <select id="compare-tab2" name="compare-tab2"></select>
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="compare-output-name" name="compare-output-name" placeholder="Output tab name (e.g., New_12_16)">
                </div>
                <div class="input-group">
                    <label for="compare-key-column">Compare by:</label>
                    <select id="compare-key-column" name="compare-key-column">
                        <option value="1">Name</option>
                        <option value="5">LinkedIn URL</option>
                    </select>
                </div>
                <button id="compare-tabs-btn" class="btn btn-primary">Compare Tabs</button>
                <div id="compare-results" class="results-box hidden"></div>
            </div>
        </section>
        
        <!-- SECTION: Schedules -->
        <section class="section" id="section-schedules">
            <div class="section-header" data-section="schedules">
                <span>‚è∞ Schedules</span>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="section-content">
                <div id="schedule-list" class="schedule-list"></div>
                <button id="add-schedule-btn" class="btn btn-secondary">+ Add Schedule</button>
                <div id="next-run-info" class="info-box"></div>
            </div>
        </section>
        
        <!-- SECTION: Execution History -->
        <section class="section" id="section-history">
            <div class="section-header" data-section="history">
                <span>üìú Execution History</span>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="section-content">
                <table id="history-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Source</th>
                            <th>Status</th>
                            <th>Profiles</th>
                        </tr>
                    </thead>
                    <tbody id="history-tbody"></tbody>
                </table>
            </div>
        </section>
        
        <!-- SECTION: Settings -->
        <section class="section" id="section-settings">
            <div class="section-header" data-section="settings">
                <span>‚öôÔ∏è Settings</span>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="section-content">
                <div class="input-group">
                    <label for="webhook-url">Zapier Webhook URL</label>
                    <input type="text" id="webhook-url" name="webhook-url" placeholder="https://hooks.zapier.com/hooks/catch/...">
                </div>
                <div class="input-group">
                    <button id="save-webhook-btn" class="btn btn-secondary">Save Webhook URL</button>
                    <button id="test-webhook-btn" class="btn btn-outline">Test Webhook</button>
                </div>
                <div id="webhook-status" class="status-text"></div>
                <div class="info-box mt-2">
                    <small>Webhook sends notifications for scraping failures with: time, failure type, person name, and search name.</small>
                </div>
            </div>
        </section>
    </main>
    
    <!-- FOOTER -->
    <footer class="footer">
        <div class="queue-status">
            <span>Queue: <span id="queue-pending">0</span> pending</span>
            <span class="separator">|</span>
            <span id="queue-failed-container" class="hidden">
                <span id="queue-failed">0</span> failed
                <button id="retry-failed-btn" class="btn-link">Retry</button>
            </span>
        </div>
        <button id="deduplicate-btn" class="btn btn-outline btn-sm">Deduplicate</button>
    </footer>
    
    <!-- MODAL: Add Schedule -->
    <div id="schedule-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Schedule</h2>
                <button id="modal-close-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="schedule-source-select">Source</label>
                    <select id="schedule-source-select" name="schedule-source-select"></select>
                </div>
                <div class="form-group">
                    <label for="schedule-day-select">Day of Week</label>
                    <select id="schedule-day-select" name="schedule-day-select">
                        <option value="0">Sunday</option>
                        <option value="1">Monday</option>
                        <option value="2">Tuesday</option>
                        <option value="3">Wednesday</option>
                        <option value="4">Thursday</option>
                        <option value="5">Friday</option>
                        <option value="6">Saturday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="schedule-frequency-select">Frequency</label>
                    <select id="schedule-frequency-select" name="schedule-frequency-select">
                        <option value="weekly">Every week</option>
                        <option value="biweekly-odd">1st &amp; 3rd week of month</option>
                        <option value="biweekly-even">2nd &amp; 4th week of month</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="schedule-time-input">Time (24-hour format, e.g., 15:30 for 3:30 PM)</label>
                    <input type="text" id="schedule-time-input" name="schedule-time-input" 
                           placeholder="HH:MM" pattern="^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$"
                           title="Enter time in 24-hour format (HH:MM), e.g., 09:00, 15:30, 23:45">
                    <small class="form-hint">Or use dropdowns: 
                        <select id="schedule-hour-select" name="schedule-hour-select" style="width: auto; display: inline-block; margin: 0 5px;"></select>
                        <select id="schedule-minute-select" name="schedule-minute-select" style="width: auto; display: inline-block; margin: 0 5px;"></select>
                    </small>
                </div>

                <div class="form-group">
                    <label class="inline-label">
                        <input type="checkbox" id="schedule-test-enabled" name="schedule-test-enabled">
                        Test mode (fast overlap testing)
                    </label>
                    <small class="form-hint">Run only a single selected search and optionally limit pages to keep runs short.</small>
                </div>

                <div id="schedule-test-options" class="hidden">
                    <div class="form-group">
                        <label for="schedule-test-search-select">Test Search (one URL)</label>
                        <select id="schedule-test-search-select" name="schedule-test-search-select"></select>
                        <small class="form-hint">This is pulled from your Input Sheet for the selected source.</small>
                    </div>

                    <div class="form-group">
                        <label for="schedule-test-max-pages">Max pages to scrape (1-10)</label>
                        <input type="number" id="schedule-test-max-pages" name="schedule-test-max-pages" min="1" max="10" value="1">
                        <small class="form-hint">Set to 1 for very fast testing; higher values increase run time.</small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-schedule-btn" class="btn btn-secondary">Cancel</button>
                <button id="save-schedule-btn" class="btn btn-primary">Save Schedule</button>
            </div>
        </div>
    </div>
    
    <!-- MODAL: Add Workbook -->
    <div id="workbook-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Workbook</h2>
                <button id="workbook-modal-close-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-workbook-url">Google Sheet URL or ID</label>
                    <input type="text" id="new-workbook-url" name="new-workbook-url" placeholder="https://docs.google.com/spreadsheets/d/...">
                </div>
                <div class="form-group">
                    <label for="new-workbook-source">Map to Source (optional)</label>
                    <select id="new-workbook-source" name="new-workbook-source"></select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-workbook-btn" class="btn btn-secondary">Cancel</button>
                <button id="confirm-workbook-btn" class="btn btn-primary">Add Workbook</button>
            </div>
        </div>
    </div>
    
    <!-- TOAST NOTIFICATIONS -->
    <div id="toast-container" class="toast-container"></div>
    
    <script src="popup.js"></script>
</body>
</html>
